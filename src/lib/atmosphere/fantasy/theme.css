/* ==========================================================================
   THEME PACK: FANTASY (The Grimoire)
   Refactored for "The Scriptorium" (Light) & "The Eldritch Vault" (Dark)
   ========================================================================== */

/* --- 1. GLOBAL TEXTURE: The Parchment Foundation --- */

/* We target the .chronicler-preview, which is the inner wrapper inside the scroll area.
   Since this wrapper expands to contain the full text content (and has min-height: 100%),
   applying the texture here ensures it scrolls with the content and never cuts off.
*/

/* Base Texture Application */
.app-shell[data-texture="fantasy-pack"] .chronicler-preview::before {
    content: "";
    position: absolute;
    inset: 0;

    background-size: 1024px auto;
    background-repeat: repeat;
    pointer-events: none;
    z-index: 0; /* Sits below the content */
    border-radius: inherit;

    /* Ensure height explicitly fills the container */
    height: 100%;
    width: 100%;
}

/* Ensure the actual content (Preview component) sits ABOVE the texture */
.app-shell[data-texture="fantasy-pack"] .chronicler-preview > * {
    position: relative;
    z-index: 1;
}

/* LIGHT MODE: The Scriptorium (Ink on Paper) */
.app-shell[data-texture="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-preview::before {
    background-image: url("./assets/parchment.jpeg");
    opacity: var(--texture-opacity, 0.25);
}

/* DARK MODE: The Eldritch Vault (Etched Stone) */
.app-shell[data-texture="fantasy-pack"][data-mode="dark"]
    .chronicler-preview::before {
    background-image: url("./assets/slate.webp");
    opacity: var(--texture-opacity, 0.3);
}

/* --- 2. INTERACTIVE ELEMENTS: Hand-Forged UI --- */

/* PHYSICS VARIABLES */
.app-shell[data-buttons="fantasy-pack"] {
    /* "Heavy Object" Curve: Fast start, heavy friction settle */
    --ease-heavy: cubic-bezier(0.25, 1, 0.5, 1);
    /* "Quill Stroke" Curve: Smooth, organic flow */
    --ease-quill: cubic-bezier(0.4, 0, 0.2, 1);
}

/* BUTTONS: The "Parchment Scrap" Shape Language */
.app-shell[data-buttons="fantasy-pack"] .btn {
    font-family: var(--font-family-heading);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    position: relative;

    /* Use the Heavy physics curve for movement */
    transition:
        transform 0.3s var(--ease-heavy),
        box-shadow 0.3s var(--ease-heavy),
        background-color 0.2s ease,
        border-color 0.2s ease;

    /* Irregular "Hand-torn" corners - slightly asymmetric */
    border-radius: 255px 25px 225px 25px / 25px 225px 25px 255px;
    border: 2px solid transparent;
}

/* LIGHT MODE BUTTONS */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"]) .btn:hover {
    transform: translateY(-3px) rotate(-0.5deg); /* Organic movement */
    box-shadow:
        0 8px 16px var(--color-overlay-medium),
        inset 0 0 10px rgba(0, 0, 0, 0.05);
}

/* PRIMARY ACTION: The "Wax Seal" (Light Mode) */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"]) .btn.primary {
    /* Pressed wax look: Deep outer shadow, strong inner highlight */
    box-shadow:
        0 4px 6px var(--color-overlay-medium),
        inset 0 -2px 5px rgba(0, 0, 0, 0.2);
}

.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"])
    .btn.primary:active {
    /* PHYSICS: The Squash Effect. Simulates malleable wax. */
    transform: translateY(2px) scale(0.98);
    box-shadow:
        0 1px 2px var(--color-overlay-medium),
        inset 0 4px 12px rgba(0, 0, 0, 0.3); /* Deeply pressed */
}

/* DARK MODE BUTTONS (The Runestone) - Keeping consistent with variable system */

/* HOVER STATE: The Floating Runestone */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn:hover {
    /* 1. Organic Movement: Lifts up and tilts slightly */
    transform: translateY(-3px) rotate(-0.5deg);
    /* 4. Shadow Depth: Stronger drop shadow implies height */
    box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.7),
        0 0 15px
            color-mix(in srgb, var(--color-accent-primary), transparent 50%); /* Subtle magical rim light */
}

/* ACTIVE STATE: Pressing the Stone */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn:active {
    transform: translateY(1px) scale(0.99); /* Heavy settle */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8); /* Shadow shrinks */
}

/* --- ENHANCED TOGGLES: Compact Arcane Socket --- */

/* The Track: Etched Stone/Metal */
[data-ui="fantasy-pack"] .slider {
    height: 22px; /* Standard Compact Height */
    width: 40px; /* Standard Compact Width */
    border-radius: 20px;
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, 0.5),
        0 1px 0 rgba(255, 255, 255, 0.1);

    transition: all 0.4s var(--ease-heavy);
}

/* The Knob: Small Glass Orb */
[data-ui="fantasy-pack"] .slider:before {
    position: absolute;
    content: "";
    height: 14px; /* Reduced for compact fit */
    width: 14px;
    left: 2px;
    bottom: 2px; /* Centers it vertically inside the 2px borders */
    border-radius: 50%;
    border: 1px solid var(--color-border-primary); /* Thinner border for small scale */

    box-shadow:
        1px 1px 3px rgba(0, 0, 0, 0.4),
        inset -1px -1px 3px rgba(0, 0, 0, 0.4),
        inset 1px 1px 3px rgba(255, 255, 255, 0.9);

    transition: all 0.4s var(--ease-heavy);
}

/* --- ACTIVE STATE --- */

[data-ui="fantasy-pack"] input:checked + .slider {
    background-color: color-mix(
        in srgb,
        var(--color-background-tertiary),
        var(--color-accent-primary) 20%
    );
    box-shadow:
        inset 0 1px 5px var(--color-accent-primary),
        0 0 3px var(--color-accent-primary);
}

[data-ui="fantasy-pack"] input:checked + .slider:before {
    transform: translateX(18px); /* Adjusted throw distance for new width */

    background-color: var(--color-accent-primary);

    box-shadow:
        0 0 8px var(--color-accent-primary),
        inset -1px -1px 3px rgba(0, 0, 0, 0.3),
        inset 1px 1px 3px rgba(255, 255, 255, 0.8);
}

/* --- 3. STRUCTURE: Borders & Containers --- */

/* SIDEBAR & APP BORDERS */
/* Use the direct child selector (>) to ensure we ONLY target the main
   navigation sidebar. This prevents the border styles from leaking onto the
   <aside> elements used for Infoboxes and TOCs inside the content area. */
.app-shell[data-borders="fantasy-pack"] > aside {
    box-sizing: border-box;
    border-right: 3px double var(--color-border-primary);
    /* Shadow creates distance between the "pages" + Inner shadow for "page curl" */
    box-shadow:
        5px 0 15px -5px var(--color-overlay-subtle),
        inset -10px 0 20px -15px rgba(0, 0, 0, 0.1);
}

/* VIEW HEADER: The Chapter Heading */
.app-shell[data-borders="fantasy-pack"] .view-header {
    /* Override default thin border with the theme's double style */
    border-bottom: 3px double var(--color-border-primary);
    position: relative;
    /* Subtle gradient to distinguish the header area from the scrolling content */
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0.02), transparent);
}

/* MODALS: The Illuminated Manuscript */
.app-shell[data-borders="fantasy-pack"] .modal-content {
    border: 3px double var(--color-accent-primary);
    border-radius: 4px;
    box-shadow:
        0 20px 50px rgba(0, 0, 0, 0.4),
        inset 0 0 60px var(--color-background-tertiary); /* Vignette inside modal */
    position: relative;
    overflow: visible;
}

/* Filigree Corners - Recolored via Mask to match Accent Variable */
.app-shell[data-borders="fantasy-pack"] .modal-content::before,
.app-shell[data-borders="fantasy-pack"] .modal-content::after {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background-color: var(--color-accent-primary); /* Dynamic coloring */
    -webkit-mask-image: url("./assets/filigree-corner.svg");
    mask-image: url("./assets/filigree-corner.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    pointer-events: none;
    opacity: 0.9;
    z-index: 10;
}

.app-shell[data-borders="fantasy-pack"] .modal-content::before {
    top: -5px;
    left: -5px;
    transform: rotate(0deg);
}
.app-shell[data-borders="fantasy-pack"] .modal-content::after {
    bottom: -5px;
    right: -5px;
    transform: rotate(180deg);
}

/* --- 4. UI ELEMENTS: Ink & Quill --- */

/* SCROLLBARS */
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar {
    width: 14px;
}
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar-track {
    border-left: 1px solid var(--color-border-primary);
    /* Texture: Dark groove */
    box-shadow: inset 1px 0 5px rgba(0, 0, 0, 0.2);
}
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar-thumb {
    border: 3px solid transparent;
    border-radius: 9px;
    background-clip: content-box;

    /* Metallic Specular Highlight */
    background-image: linear-gradient(
        135deg,
        transparent 40%,
        rgba(255, 255, 255, 0.5) 50%,
        transparent 60%
    );
    background-size: 100% 100%;
}

/* SEPARATORS: Ink Flourishes */
/* Scoped to .chronicler-content to prevent affecting UI elements like Context Menus */
/* LARGE style for main content */
.app-shell[data-ui="fantasy-pack"] .chronicler-content hr,
.app-shell[data-ui="fantasy-pack"] .modal-content hr,
.app-shell[data-ui="fantasy-pack"] .layout-separator {
    border: 0;
    height: 24px;
    margin: 2rem 0;
    background-color: var(--color-accent-primary);
    -webkit-mask-image: url("./assets/separator.svg");
    mask-image: url("./assets/separator.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;
    opacity: 0.8;
}

/* COMPACT style for Context Menus */
.app-shell[data-ui="fantasy-pack"] .context-menu hr,
.app-shell[data-ui="fantasy-pack"] .dropdown-menu hr {
    border: 0;
    height: 12px; /* Smaller height */
    margin: 0.5rem 0; /* Tighter margins */
    background-color: var(--color-accent-primary);
    -webkit-mask-image: url("./assets/separator.svg");
    mask-image: url("./assets/separator.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;
    opacity: 0.6;
}

/* --- ENHANCED INPUTS: The Pressed Groove --- */

.app-shell[data-ui="fantasy-pack"] .dropdown-select,
.app-shell[data-ui="fantasy-pack"] .select-trigger,
.app-shell[data-ui="fantasy-pack"] input[type="text"],
.app-shell[data-ui="fantasy-pack"] input[type="search"],
.app-shell[data-ui="fantasy-pack"] select {
    /* TYPOGRAPHY */
    font-size: 1rem;
    letter-spacing: 0.02em;

    /* SHAPE & STRUCTURE */
    /* Hand-cut paper feel: slightly irregular corners */
    border-radius: 3px 255px 2px 255px / 255px 2px 255px 3px;
    border: 1px solid transparent; /* Placeholder for transition */
    padding: 0.6rem 1rem;

    /* REMOVE DEFAULT BROWSER STYLES */
    appearance: none;
    -webkit-appearance: none;
    outline: none;

    /* ANIMATION */
    transition:
        background-color 0.3s ease,
        box-shadow 0.3s var(--ease-heavy),
        transform 0.2s var(--ease-quill),
        border-color 0.3s ease;
}

/* LIGHT MODE: The Paper Indentation */
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) .dropdown-select,
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) .select-trigger,
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) input,
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) select {
    background-color: rgba(0, 0, 0, 0.03); /* Faint stain */
    border-color: rgba(0, 0, 0, 0.1);

    /* Inner shadow creates the "pressed into paper" depth */
    box-shadow:
        inset 0 2px 6px rgba(0, 0, 0, 0.08),
        inset 0 1px 2px rgba(0, 0, 0, 0.1),
        0 1px 0 rgba(255, 255, 255, 0.5); /* Bottom highlight edge */
}

/* DARK MODE: The Etched Stone */
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] .dropdown-select,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] .select-trigger,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] input,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] select {
    background-color: rgba(0, 0, 0, 0.2); /* Deep etching */
    border-color: rgba(255, 255, 255, 0.05);
    color: var(--color-text-secondary);

    /* Sharp inner shadow for chiseled look */
    box-shadow:
        inset 0 3px 8px rgba(0, 0, 0, 0.6),
        0 1px 0 rgba(255, 255, 255, 0.05);
}

/* --- INTERACTION STATES --- */

/* HOVER: The Anticipation */
.app-shell[data-ui="fantasy-pack"] select:hover {
    cursor: text;
    background-color: rgba(0, 0, 0, 0.06);
}
.app-shell[data-ui="fantasy-pack"] select:hover {
    cursor: pointer;
}

/* FOCUS: The Ink Bleed / Rune Glow */
.app-shell[data-ui="fantasy-pack"] input:focus,
.app-shell[data-ui="fantasy-pack"] .select-trigger:focus,
.app-shell[data-ui="fantasy-pack"] select:focus {
    transform: scale(1.01); /* Subtle expansion */
}

/* Light Mode Focus: Wet Ink Edge */
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) input:focus,
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"])
    .select-trigger:focus,
.app-shell[data-ui="fantasy-pack"]:not([data-mode="dark"]) select:focus {
    box-shadow:
        0 0 0 1px var(--color-accent-primary),
        /* Simulated thick border */ 0 4px 12px var(--color-overlay-subtle); /* Lift off page */
}

/* Dark Mode Focus: Magicka Activation */
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] input:focus,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] .select-trigger:focus,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] select:focus {
    box-shadow:
        inset 0 0 15px
            color-mix(in srgb, var(--color-accent-primary), transparent 50%),
        /* Inner Glow */ 0 0 10px
            color-mix(in srgb, var(--color-accent-primary), transparent 50%); /* Outer Glow */
    color: var(--color-accent-primary);
}

/* --- DROPDOWNS: The Wax Seal Indicator --- */

/* We use a custom SVG mask or background image for the arrow to ensure
   it matches the theme, rather than the browser default chevron. */

.app-shell[data-ui="fantasy-pack"] select {
    padding-right: 2.5rem; /* Make room for the custom icon */

    /* Custom Diamond/Lozenge Arrow */
    background-image: url("./assets/input-chevron.svg");
    background-repeat: no-repeat;
    background-position: right 0.8rem center;
    background-size: 1rem;
}

/* Adjust Icon Color for Dark Mode via Data URI replacement
   (Note: In a real prod env, using mask-image is better for color control,
   but background-image is safer for cross-browser select styling) */
.app-shell[data-ui="fantasy-pack"][data-mode="dark"] select {
    background-image: url("./assets/input-chevron-dark.svg");
}

/* --- 5. FRAMES --- */
.app-shell[data-frames="fantasy-pack"] .gallery-item,
.app-shell[data-frames="fantasy-pack"] .carousel-stack,
.app-shell[data-frames="fantasy-pack"] .gallery figure,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper {
    position: relative;
    padding: 6px;
    border: 1px solid var(--color-border-primary);
    border-radius: 2px;
    box-shadow:
        0 4px 6px -1px var(--color-overlay-dark),
        0 2px 4px -1px var(--color-overlay-subtle);
    overflow: hidden;
}

.app-shell[data-frames="fantasy-pack"] .gallery-item img,
.app-shell[data-frames="fantasy-pack"] .carousel-stack img,
.app-shell[data-frames="fantasy-pack"] .gallery figure img,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper img {
    border: 1px solid rgba(0, 0, 0, 0.1);
    display: block;
}

/* Inner border */
.app-shell[data-frames="fantasy-pack"] .gallery-item::before,
.app-shell[data-frames="fantasy-pack"] .carousel-stack::before,
.app-shell[data-frames="fantasy-pack"] .gallery figure::before,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper::before {
    content: "";
    position: absolute;
    inset: 3px;
    opacity: 0.8;
    pointer-events: none;
    z-index: 10;
}

/* Outer ornate corners */
.app-shell[data-frames="fantasy-pack"] .gallery-item::after,
.app-shell[data-frames="fantasy-pack"] .carousel-stack::after,
.app-shell[data-frames="fantasy-pack"] .gallery figure::after,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 11;
    background-color: var(--color-accent-primary);
    -webkit-mask-image:
        url("./assets/frame-tl.svg"), url("./assets/frame-tr.svg"),
        url("./assets/frame-br.svg"), url("./assets/frame-bl.svg");
    -webkit-mask-position:
        top left,
        top right,
        bottom right,
        bottom left;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 18px 18px;
    mask-image:
        url("./assets/frame-tl.svg"), url("./assets/frame-tr.svg"),
        url("./assets/frame-br.svg"), url("./assets/frame-bl.svg");
    mask-position:
        top left,
        top right,
        bottom right,
        bottom left;
    mask-repeat: no-repeat;
    mask-size: 18px 18px;
}

/* --- 6. TYPOGRAPHY: The Arcane Links --- */

/* Header Ligatures (Stylistic Sets) */
.app-shell[data-typography="fantasy-pack"] h1,
.app-shell[data-typography="fantasy-pack"] h2,
.app-shell[data-typography="fantasy-pack"] h3,
.app-shell[data-typography="fantasy-pack"] h4,
.app-shell[data-typography="fantasy-pack"] h5,
.app-shell[data-typography="fantasy-pack"] h6,
.app-shell[data-typography="fantasy-pack"] .infobox-title {
    /* Enable Discretionary and Historical ligatures for that "hand-scribed" look */
    font-variant-ligatures: discretionary-ligatures historical-ligatures;
    /* Attempt common stylistic sets (ss01, etc) which often contain alternate glyphs */
    font-feature-settings: "dlig", "hlig", "ss01";
}

/* MATERIALITY: Absorbed Ink (Light Mode) */
/* We target headers and body text to blend them into the parchment texture. */
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h1,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h2,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h3,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    p,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    li {
    /* MULTIPLY blend mode simulates ink soaking INTO the paper fibers */
    mix-blend-mode: multiply;
    /* Slight transparency allows the texture grain to show through the "drying ink" */
    opacity: 0.95;
}

/* BASE LINK STYLES */
.app-shell[data-typography="fantasy-pack"] .chronicler-content a.internal-link {
    position: relative;
    text-decoration: none;
    border-bottom: none; /* We will redraw this procedurally */
    cursor: pointer;
    transition: all 0.3s ease;

    /* The "Underline" is now a procedural gradient (for animation) */
    background-image: linear-gradient(currentColor, currentColor);
    background-position: 0% 100%;
    background-repeat: no-repeat;
    background-size: 100% 1px; /* Thin line by default */
}

/* LIGHT MODE: "The Wet Ink" */
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    a.internal-link {
    background-size: 0% 1px; /* No underline initially */
    /* Ensure links also blend */
    mix-blend-mode: multiply;
}

.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    a.internal-link:hover {
    /* A faint underline appears */
    background-size: 100% 1px;
}

/* DARK MODE: "The Runic Glow" */
.app-shell[data-typography="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    a.internal-link {
    background-size: 0% 1px; /* No underline initially */

    /* Faint ambient glow */
    text-shadow: 0 0 2px
        color-mix(in srgb, var(--color-text-link), transparent 50%);
}

.app-shell[data-typography="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    a.internal-link:hover {
    color: var(--color-accent-primary);

    /* The Glow Intensifies */
    text-shadow:
        0 0 5px var(--color-text-link),
        0 0 10px var(--color-accent-primary);

    /* A faint underline appears */
    background-size: 100% 1px;
}

/* --- BROKEN LINKS: "The Smudged Entry" --- */

.app-shell[data-typography="fantasy-pack"]
    .chronicler-content
    a.internal-link.broken {
    opacity: 0.7;

    /* A "Jagged" or "Torn" underline style */
    background-image: none; /* Remove the smooth gradient */
    border-bottom: 2px dotted var(--color-text-link-broken);
    font-style: italic; /* Looks like a correction or mistake */
}

.app-shell[data-typography="fantasy-pack"]
    .chronicler-content
    a.internal-link.broken:hover {
    opacity: 1;
    color: var(--color-text-error); /* Highlights the error clearly */
    border-bottom-style: dashed;

    /* A "glitch" or "shake" suggestion via skew */
    transform: skewX(-10deg);
}

/* --- 7. CONTENT WIDGETS (Infobox & TOC) --- */
/* Lift these elements off the page so they don't blend into the background texture.
   They should look like separate scraps of paper or tablets placed on top of the scroll. */

.app-shell[data-borders="fantasy-pack"] .chronicler-content .infobox,
.app-shell[data-borders="fantasy-pack"] .chronicler-content .toc-container {
    /* 1. Opaque Background: Use the primary color to ensure the widget is solid.
       This prevents the global parchment texture from blending through the text. */
    background-color: var(--color-background-primary);

    /* 2. Border: Reinforce the edge to define it as a separate object. */
    border: 2px solid var(--color-border-primary);
    border-radius: 4px;

    /* 3. Shadow: Critical for the "on top" feel. Lift it up! */
    box-shadow:
        0 4px 12px var(--color-overlay-medium),
        inset 0 0 40px var(--color-overlay-subtle); /* Subtle inner vignette for age */

    /* 4. Layering: Ensure it sits above the texture layer */
    position: relative;
    z-index: 2;
    overflow: visible; /* Ensure ornamental corners can stick out */
}

/* Ornamental Corners for Infobox and TOC */
.app-shell[data-borders="fantasy-pack"] .chronicler-content .infobox::before,
.app-shell[data-borders="fantasy-pack"]
    .chronicler-content
    .toc-container::before,
.app-shell[data-borders="fantasy-pack"] .chronicler-content .infobox::after,
.app-shell[data-borders="fantasy-pack"]
    .chronicler-content
    .toc-container::after {
    content: "";
    position: absolute;
    width: 40px; /* Slightly smaller than modal corners (60px) for widget scale */
    height: 40px;
    background-color: var(--color-accent-primary);
    -webkit-mask-image: url("./assets/filigree-corner.svg");
    mask-image: url("./assets/filigree-corner.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    pointer-events: none;
    opacity: 0.8;
    z-index: 10;
}

/* Top-Left Corner */
.app-shell[data-borders="fantasy-pack"] .chronicler-content .infobox::before,
.app-shell[data-borders="fantasy-pack"]
    .chronicler-content
    .toc-container::before {
    top: -4px;
    left: -4px;
    transform: rotate(0deg);
}

/* Bottom-Right Corner */
.app-shell[data-borders="fantasy-pack"] .chronicler-content .infobox::after,
.app-shell[data-borders="fantasy-pack"]
    .chronicler-content
    .toc-container::after {
    bottom: -4px;
    right: -4px;
    transform: rotate(180deg);
}

/* Dark Mode Specifics: Make them feel like stone tablets */
.app-shell[data-borders="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    .infobox,
.app-shell[data-borders="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    .toc-container {
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); /* Deeper shadow for dark mode */
}

/* ==========================================================================
   VIEW HEADER NAVIGATION: The Compass
   ========================================================================== */

/* 1. CONTAINER SHAPE: The Coin / Seal */
.app-shell[data-buttons="fantasy-pack"] .view-header .btn.ghost,
.app-shell[data-buttons="fantasy-pack"] .view-header .nav-button {
    width: 36px;
    height: 36px;
    padding: 0;

    /* Perfect Circle vs Organic Circle? Let's go Organic. */
    border-radius: 50% 45% 55% 40% / 40% 55% 45% 50%;

    /* Base State: Faintly etched */
    background-color: transparent;
    border: 1px solid transparent; /* Reserve space */

    /* Animation */
    transition:
        background-color 0.3s ease,
        color 0.2s ease,
        transform 0.4s var(--ease-heavy),
        box-shadow 0.3s ease;

    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* 2. LIGHT MODE: The Fading Ink */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"])
    .view-header
    .btn.ghost {
    /* Subtle border to define the click area without being heavy */
    border-color: rgba(0, 0, 0, 0.05);
}

/* Hover: Ink Wash */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"])
    .view-header
    .btn.ghost:hover {
    background-color: rgba(0, 0, 0, 0.05); /* Slight stain */
    transform: rotate(-5deg) scale(1.05); /* Organic tilt */

    box-shadow:
        0 2px 5px rgba(0, 0, 0, 0.1),
        inset 0 0 10px rgba(255, 255, 255, 0.5);
}

/* Active/Click: Pressed Paper */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"])
    .view-header
    .btn.ghost:active {
    transform: scale(0.95);
    background-color: rgba(0, 0, 0, 0.1);
}

/* 3. DARK MODE: The Floating Embers */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"]
    .view-header
    .btn.ghost {
    border-color: rgba(255, 255, 255, 0.05);
}

/* Hover: Rune Ignition */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"]
    .view-header
    .btn.ghost:hover {
    background-color: var(--color-background-tertiary);
    color: var(--color-accent-primary);
    border-color: var(--color-accent-primary);

    /* The Glow */
    box-shadow:
        0 0 10px
            color-mix(in srgb, var(--color-accent-primary), transparent 50%),
        inset 0 0 5px
            color-mix(in srgb, var(--color-accent-primary), transparent 50%);

    transform: rotate(5deg) scale(1.1);
}

/* 4. ICON REPLACEMENT (The Magic) */
/* We hide the default SVG icon (usually an <i> or <svg>) and replace it
   using a pseudo-element mask for full color control. */

.app-shell[data-buttons="fantasy-pack"] .view-header .btn.ghost svg,
.app-shell[data-buttons="fantasy-pack"] .view-header .nav-button svg {
    opacity: 0; /* Hide original */
}

.app-shell[data-buttons="fantasy-pack"] .view-header .btn.ghost::after,
.app-shell[data-buttons="fantasy-pack"] .view-header .nav-button::after {
    content: "";
    position: absolute;
    inset: 0;
    background-color: currentColor; /* Adopts the text color defined above */

    -webkit-mask-size: 20px 20px;
    mask-size: 20px 20px;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
    pointer-events: none;
}

/* Target specific buttons based on class or attribute to assign the correct arrow */
/* You might need to adjust the selectors like [aria-label="Back"] depending on your HTML */

/* BACK BUTTON */
.app-shell[data-buttons="fantasy-pack"]
    .view-header
    .btn.ghost:first-child::after,
.app-shell[data-buttons="fantasy-pack"]
    .view-header
    .btn[data-action="back"]::after {
    -webkit-mask-image: url("./assets/arrow-nav-left.svg");
    mask-image: url("./assets/arrow-nav-left.svg");
}

/* FORWARD BUTTON */
.app-shell[data-buttons="fantasy-pack"]
    .view-header
    .btn.ghost:last-child::after,
.app-shell[data-buttons="fantasy-pack"]
    .view-header
    .btn[data-action="forward"]::after {
    -webkit-mask-image: url("./assets/arrow-nav-right.svg");
    mask-image: url("./assets/arrow-nav-right.svg");
}

/* DISABLED STATE: The Faded Manuscript */
.app-shell[data-buttons="fantasy-pack"] .view-header .btn.ghost:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
    border-color: transparent !important;
    filter: grayscale(100%);
}
