/* ==========================================================================
   THEME PACK: FANTASY (The Grimoire)
   Refactored for "The Scriptorium" (Light) & "The Eldritch Vault" (Dark)
   ========================================================================== */

/* --- 1. GLOBAL TEXTURE: The Parchment Foundation --- */

/* We target the .chronicler-preview, which is the inner wrapper inside the scroll area.
   Since this wrapper expands to contain the full text content (and has min-height: 100%),
   applying the texture here ensures it scrolls with the content and never cuts off.
*/

/* Base Texture Application */
.app-shell[data-texture="fantasy-pack"] .chronicler-preview::before {
    content: "";
    position: absolute;
    inset: 0;

    background-size: 1024px auto;
    background-repeat: repeat;
    pointer-events: none;
    z-index: 0; /* Sits below the content */
    border-radius: inherit;

    /* Ensure height explicitly fills the container */
    height: 100%;
    width: 100%;
}

/* Ensure the actual content (Preview component) sits ABOVE the texture */
.app-shell[data-texture="fantasy-pack"] .chronicler-preview > * {
    position: relative;
    z-index: 1;
}

/* LIGHT MODE: The Scriptorium (Ink on Paper) */
.app-shell[data-texture="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-preview::before {
    background-image: url("./assets/parchment-texture.jpg");
    opacity: 0.25;
}

/* DARK MODE: The Eldritch Vault (Etched Stone) */
.app-shell[data-texture="fantasy-pack"][data-mode="dark"]
    .chronicler-preview::before {
    background-image: url("./assets/slate-texture.jpg");
    opacity: 0.3;
}

/* --- 2. INTERACTIVE ELEMENTS: Hand-Forged UI --- */

/* PHYSICS VARIABLES */
.app-shell[data-buttons="fantasy-pack"] {
    /* "Heavy Object" Curve: Fast start, heavy friction settle */
    --ease-heavy: cubic-bezier(0.25, 1, 0.5, 1);
    /* "Quill Stroke" Curve: Smooth, organic flow */
    --ease-quill: cubic-bezier(0.4, 0, 0.2, 1);
}

/* BUTTONS: The "Parchment Scrap" Shape Language */
.app-shell[data-buttons="fantasy-pack"] .btn {
    font-family: var(--font-family-heading);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    position: relative;

    /* Use the Heavy physics curve for movement */
    transition:
        transform 0.3s var(--ease-heavy),
        box-shadow 0.3s var(--ease-heavy),
        background-color 0.2s ease,
        border-color 0.2s ease;

    /* Irregular "Hand-torn" corners - slightly asymmetric */
    border-radius: 255px 25px 225px 25px / 25px 225px 25px 255px;
    border: 2px solid transparent;
}

/* LIGHT MODE BUTTONS */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"]) .btn {
    background-color: var(--color-background-secondary);
    color: var(--color-text-primary);
    border-color: var(--color-border-primary);

    /* Layered shadows to simulate paper thickness lifting off the desk */
    box-shadow:
        0 2px 5px var(--color-overlay-subtle),
        inset 0 0 20px rgba(0, 0, 0, 0.02);
}

.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"]) .btn:hover {
    transform: translateY(-3px) rotate(-0.5deg); /* Organic movement */
    background-color: var(--color-background-primary);
    box-shadow:
        0 8px 16px var(--color-overlay-medium),
        inset 0 0 10px rgba(0, 0, 0, 0.05);
    border-color: var(--color-text-secondary); /* "Ink" soaking edge */
}

/* PRIMARY ACTION: The "Wax Seal" (Light Mode) */
.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"]) .btn.primary {
    background-color: var(--color-accent-primary);
    color: var(--color-background-primary);
    border: 2px solid var(--color-accent-secondary);

    /* Pressed wax look: Deep outer shadow, strong inner highlight */
    box-shadow:
        0 4px 6px var(--color-overlay-medium),
        inset 0 -2px 5px rgba(0, 0, 0, 0.2);
}

.app-shell[data-buttons="fantasy-pack"]:not([data-mode="dark"])
    .btn.primary:active {
    /* PHYSICS: The Squash Effect. Simulates malleable wax. */
    transform: translateY(2px) scale(0.98);
    box-shadow:
        0 1px 2px var(--color-overlay-medium),
        inset 0 4px 12px rgba(0, 0, 0, 0.3); /* Deeply pressed */
}

/* DARK MODE BUTTONS (The Runestone) - Keeping consistent with variable system */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn {
    background-color: var(--color-background-tertiary);
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border-primary);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
}

.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn.primary {
    background-color: var(--color-background-primary);
    color: var(--color-accent-primary);
    border-color: var(--color-accent-primary);
    box-shadow: 0 0 15px var(--color-accent-primary-alpha); /* Glow */
}

/* HOVER STATE: The Floating Runestone */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn:hover {
    /* 1. Organic Movement: Lifts up and tilts slightly */
    transform: translateY(-3px) rotate(-0.5deg);

    /* 2. Material Shift: "Closer to light" = slightly lighter stone */
    background-color: var(--color-background-secondary);

    /* 3. Etching Glow: The borders catch the ambient light */
    border-color: var(--color-text-secondary);

    /* 4. Shadow Depth: Stronger drop shadow implies height */
    box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.7),
        0 0 8px var(--color-accent-primary-alpha); /* Subtle magical rim light */
}

/* ACTIVE STATE: Pressing the Stone */
.app-shell[data-buttons="fantasy-pack"][data-mode="dark"] .btn:active {
    transform: translateY(1px) scale(0.99); /* Heavy settle */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8); /* Shadow shrinks */
    border-color: var(--color-accent-primary); /* Rune flares on contact */
}

/* --- ENHANCED TOGGLES: Compact Arcane Socket --- */

/* The Track: Etched Stone/Metal */
[data-ui="fantasy-pack"] .slider {
    height: 22px; /* Standard Compact Height */
    width: 40px; /* Standard Compact Width */
    border-radius: 20px;

    background-color: var(--color-background-tertiary);
    border: 2px solid var(--color-border-primary);

    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, 0.5),
        0 1px 0 rgba(255, 255, 255, 0.1);

    transition: all 0.4s var(--ease-heavy);
}

/* The Knob: Small Glass Orb */
[data-ui="fantasy-pack"] .slider:before {
    position: absolute;
    content: "";
    height: 14px; /* Reduced for compact fit */
    width: 14px;
    left: 2px;
    bottom: 2px; /* Centers it vertically inside the 2px borders */

    background-color: var(--color-background-primary);
    border-radius: 50%;
    border: 1px solid var(--color-border-primary); /* Thinner border for small scale */

    box-shadow:
        1px 1px 3px rgba(0, 0, 0, 0.4),
        inset -1px -1px 3px rgba(0, 0, 0, 0.4),
        inset 1px 1px 3px rgba(255, 255, 255, 0.9);

    transition: all 0.4s var(--ease-heavy);
}

/* --- ACTIVE STATE --- */

[data-ui="fantasy-pack"] input:checked + .slider {
    background-color: color-mix(
        in srgb,
        var(--color-background-tertiary),
        var(--color-accent-primary) 20%
    );
    border-color: var(--color-accent-secondary);
    box-shadow:
        inset 0 1px 5px var(--color-accent-primary),
        0 0 3px var(--color-accent-primary);
}

[data-ui="fantasy-pack"] input:checked + .slider:before {
    transform: translateX(18px); /* Adjusted throw distance for new width */

    background-color: var(--color-accent-primary);
    border-color: var(--color-accent-secondary);

    box-shadow:
        0 0 8px var(--color-accent-primary),
        inset -1px -1px 3px rgba(0, 0, 0, 0.3),
        inset 1px 1px 3px rgba(255, 255, 255, 0.8);
}

/* --- 3. STRUCTURE: Borders & Containers --- */

/* SIDEBAR & APP BORDERS */
/* Use the direct child selector (>) to ensure we ONLY target the main
   navigation sidebar. This prevents the border styles from leaking onto the
   <aside> elements used for Infoboxes and TOCs inside the content area. */
.app-shell[data-app-border="fantasy-pack"] > aside {
    box-sizing: border-box;
    border-right: 3px double var(--color-border-primary);
    /* Shadow creates distance between the "pages" */
    box-shadow: 5px 0 15px -5px var(--color-overlay-subtle);
}

/* MODALS: The Illuminated Manuscript */
.app-shell[data-app-border="fantasy-pack"] .modal-content {
    border: 3px double var(--color-accent-primary);
    border-radius: 4px;
    background-color: var(--color-background-primary);
    box-shadow:
        0 20px 50px rgba(0, 0, 0, 0.4),
        inset 0 0 60px var(--color-background-tertiary); /* Vignette inside modal */
    position: relative;
    overflow: visible;
}

/* Filigree Corners - Recolored via Mask to match Accent Variable */
.app-shell[data-app-border="fantasy-pack"] .modal-content::before,
.app-shell[data-app-border="fantasy-pack"] .modal-content::after {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background-color: var(--color-accent-primary); /* Dynamic coloring */
    -webkit-mask-image: url("./assets/filigree-corner.svg");
    mask-image: url("./assets/filigree-corner.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    pointer-events: none;
    opacity: 0.9;
    z-index: 10;
}

.app-shell[data-app-border="fantasy-pack"] .modal-content::before {
    top: -5px;
    left: -5px;
    transform: rotate(0deg);
}
.app-shell[data-app-border="fantasy-pack"] .modal-content::after {
    bottom: -5px;
    right: -5px;
    transform: rotate(180deg);
}

/* --- 4. UI ELEMENTS: Ink & Quill --- */

/* SCROLLBARS: Wood & Rope Style */
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar {
    width: 14px;
}
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar-track {
    background-color: var(--color-background-tertiary);
    border-left: 1px solid var(--color-border-primary);
    /* Texture: Dark groove */
    box-shadow: inset 1px 0 5px rgba(0, 0, 0, 0.2);
}
.app-shell[data-ui="fantasy-pack"] ::-webkit-scrollbar-thumb {
    background-color: var(--color-accent-primary);
    border: 3px solid transparent;
    border-radius: 9px;
    background-clip: content-box;

    /* Metallic Specular Highlight */
    background-image: linear-gradient(
        135deg,
        transparent 40%,
        rgba(255, 255, 255, 0.5) 50%,
        transparent 60%
    );
    background-size: 100% 100%;
}

/* SEPARATORS: Ink Flourishes */
/* Scoped to .chronicler-content to prevent affecting UI elements like Context Menus */
/* LARGE style for main content */
.app-shell[data-ui="fantasy-pack"] .chronicler-content hr,
.app-shell[data-ui="fantasy-pack"] .modal-content hr,
.app-shell[data-ui="fantasy-pack"] .layout-separator {
    border: 0;
    height: 24px;
    margin: 2rem 0;
    background-color: var(--color-accent-primary);
    -webkit-mask-image: url("./assets/separator.svg");
    mask-image: url("./assets/separator.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;
    opacity: 0.8;
}

/* COMPACT style for Context Menus */
.app-shell[data-ui="fantasy-pack"] .context-menu hr,
.app-shell[data-ui="fantasy-pack"] .dropdown-menu hr {
    border: 0;
    height: 12px; /* Smaller height */
    margin: 0.5rem 0; /* Tighter margins */
    background-color: var(--color-accent-primary);
    -webkit-mask-image: url("./assets/separator.svg");
    mask-image: url("./assets/separator.svg");
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;
    opacity: 0.6;
}

/* Inputs: Ink & Quill Style */
.app-shell[data-ui="fantasy-pack"] .dropdown-select,
.app-shell[data-ui="fantasy-pack"] input[type="text"],
.app-shell[data-ui="fantasy-pack"] input[type="search"],
.app-shell[data-ui="fantasy-pack"] select {
    background-color: var(--color-background-primary);
    border: none;
    background-image:
        linear-gradient(
            var(--color-accent-primary),
            var(--color-accent-primary)
        ),
        linear-gradient(
            var(--color-border-primary),
            var(--color-border-primary)
        );
    background-size:
        0% 2px,
        100% 2px;
    background-repeat: no-repeat;
    background-position:
        center bottom,
        center bottom;
    border-radius: 0;
    font-family: var(--font-family-heading) !important;
    padding: 0.6rem;
    box-shadow: inset 0 -5px 10px -5px var(--color-overlay-medium);

    /* ANIMATION: Quill Flow */
    transition:
        background-size 0.6s var(--ease-quill),
        /* Slow, deliberate stroke */ background-color 0.3s ease;

    mask-image: linear-gradient(black, black);
}

.app-shell[data-ui="fantasy-pack"] .dropdown-select:focus,
.app-shell[data-ui="fantasy-pack"] input:focus,
.app-shell[data-ui="fantasy-pack"] select:focus {
    outline: none;
    background-color: var(--color-background-secondary);
    padding-left: 1rem;

    /* Expands from center (or left) to fill the width */
    background-size:
        100% 2px,
        100% 2px;

    caret-color: var(--color-text-primary);
}

.app-shell[data-ui="fantasy-pack"] .dropdown-select,
.app-shell[data-ui="fantasy-pack"] select {
    background-image: url("./assets/input-chevron.svg");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    background-size: 1.2rem;
}

.app-shell[data-ui="fantasy-pack"] .dropdown-menu {
    border: 3px double var(--color-border-primary) !important;
    border-radius: 2px !important;
    box-shadow:
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 0 20px var(--color-overlay-medium) !important;
    background-color: var(--color-background-primary) !important;
}

/* --- 5. FRAMES --- */
.app-shell[data-frames="fantasy-pack"] .gallery-item,
.app-shell[data-frames="fantasy-pack"] .carousel-stack,
.app-shell[data-frames="fantasy-pack"] .gallery figure,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper {
    position: relative;
    padding: 6px;
    background-color: var(--color-background-secondary);
    border: 1px solid var(--color-border-primary);
    border-radius: 2px;
    box-shadow:
        0 4px 6px -1px var(--color-overlay-dark),
        0 2px 4px -1px var(--color-overlay-subtle);
    overflow: hidden;
}

.app-shell[data-frames="fantasy-pack"] .gallery-item img,
.app-shell[data-frames="fantasy-pack"] .carousel-stack img,
.app-shell[data-frames="fantasy-pack"] .gallery figure img,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper img {
    border: 1px solid rgba(0, 0, 0, 0.1);
    display: block;
}

/* Inner border */
.app-shell[data-frames="fantasy-pack"] .gallery-item::before,
.app-shell[data-frames="fantasy-pack"] .carousel-stack::before,
.app-shell[data-frames="fantasy-pack"] .gallery figure::before,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper::before {
    content: "";
    position: absolute;
    inset: 3px;
    border: 1px solid var(--color-accent-primary);
    opacity: 0.8;
    pointer-events: none;
    z-index: 10;
}

/* Outer ornate corners */
.app-shell[data-frames="fantasy-pack"] .gallery-item::after,
.app-shell[data-frames="fantasy-pack"] .carousel-stack::after,
.app-shell[data-frames="fantasy-pack"] .gallery figure::after,
.app-shell[data-frames="fantasy-pack"] .gallery .gallery-item-wrapper::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 11;
    background-color: var(--color-accent-primary);
    -webkit-mask-image:
        url("./assets/frame-tl.svg"), url("./assets/frame-tr.svg"),
        url("./assets/frame-br.svg"), url("./assets/frame-bl.svg");
    -webkit-mask-position:
        top left,
        top right,
        bottom right,
        bottom left;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 18px 18px;
    mask-image:
        url("./assets/frame-tl.svg"), url("./assets/frame-tr.svg"),
        url("./assets/frame-br.svg"), url("./assets/frame-bl.svg");
    mask-position:
        top left,
        top right,
        bottom right,
        bottom left;
    mask-repeat: no-repeat;
    mask-size: 18px 18px;
}

/* --- 6. TYPOGRAPHY: The Arcane Links --- */

/* Header Ligatures (Stylistic Sets) */
.app-shell[data-typography="fantasy-pack"] h1,
.app-shell[data-typography="fantasy-pack"] h2,
.app-shell[data-typography="fantasy-pack"] h3,
.app-shell[data-typography="fantasy-pack"] h4,
.app-shell[data-typography="fantasy-pack"] h5,
.app-shell[data-typography="fantasy-pack"] h6,
.app-shell[data-typography="fantasy-pack"] .infobox-title {
    /* Enable Discretionary and Historical ligatures for that "hand-scribed" look */
    font-variant-ligatures: discretionary-ligatures historical-ligatures;
    /* Attempt common stylistic sets (ss01, etc) which often contain alternate glyphs */
    font-feature-settings: "dlig", "hlig", "ss01";
}

/* MATERIALITY: Absorbed Ink (Light Mode) */
/* We target headers and body text to blend them into the parchment texture. */
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h1,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h2,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    h3,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    p,
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    li {
    /* MULTIPLY blend mode simulates ink soaking INTO the paper fibers */
    mix-blend-mode: multiply;
    /* Slight transparency allows the texture grain to show through the "drying ink" */
    opacity: 0.95;
}

/* BASE LINK STYLES */
.app-shell[data-typography="fantasy-pack"] .chronicler-content a.internal-link {
    position: relative;
    color: var(--color-text-link);
    text-decoration: none;
    border-bottom: none; /* We will redraw this procedurally */
    cursor: pointer;
    transition: all 0.3s ease;

    /* The "Underline" is now a procedural gradient (for animation) */
    background-image: linear-gradient(currentColor, currentColor);
    background-position: 0% 100%;
    background-repeat: no-repeat;
    background-size: 100% 1px; /* Thin line by default */
}

/* LIGHT MODE: "The Wet Ink" */
.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    a.internal-link {
    /* Slightly heavier font weight to simulate quill pressure */
    font-weight: 500;
    /* Ensure links also blend */
    mix-blend-mode: multiply;
}

.app-shell[data-typography="fantasy-pack"]:not([data-mode="dark"])
    .chronicler-content
    a.internal-link:hover {
    color: var(--color-accent-primary); /* Ink changes color */
    background-size: 100% 2px; /* Line thickens */

    /* The "Highlighter" Effect: A wash of color behind the text */
    box-shadow: inset 0 -0.5em 0
        color-mix(in srgb, var(--color-accent-primary), transparent 85%);
    border-radius: 2px;
}

/* DARK MODE: "The Runic Glow" */
.app-shell[data-typography="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    a.internal-link {
    background-size: 0% 1px; /* No underline initially in dark mode */

    /* Faint ambient glow */
    text-shadow: 0 0 2px
        color-mix(in srgb, var(--color-text-link), transparent 50%);
}

.app-shell[data-typography="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    a.internal-link:hover {
    color: var(--color-accent-primary);

    /* The Glow Intensifies */
    text-shadow:
        0 0 5px var(--color-text-link),
        0 0 10px var(--color-accent-primary);

    /* Optional: A faint underline appears */
    background-size: 100% 1px;
}

/* --- BROKEN LINKS: "The Smudged Entry" --- */

.app-shell[data-typography="fantasy-pack"]
    .chronicler-content
    a.internal-link.broken {
    color: var(--color-text-link-broken);
    opacity: 0.7;

    /* A "Jagged" or "Torn" underline style */
    background-image: none; /* Remove the smooth gradient */
    border-bottom: 2px dotted var(--color-text-link-broken);
    font-style: italic; /* Looks like a correction or mistake */
}

.app-shell[data-typography="fantasy-pack"]
    .chronicler-content
    a.internal-link.broken:hover {
    opacity: 1;
    color: var(--color-text-error); /* Highlights the error clearly */
    border-bottom-style: dashed;

    /* A "glitch" or "shake" suggestion via skew */
    transform: skewX(-10deg);
}

/* --- 7. CONTENT WIDGETS (Infobox & TOC) --- */
/* Lift these elements off the page so they don't blend into the background texture.
   They should look like separate scraps of paper or tablets placed on top of the scroll. */

.app-shell[data-ui="fantasy-pack"] .chronicler-content .infobox,
.app-shell[data-ui="fantasy-pack"] .chronicler-content .toc-container {
    /* 1. Opaque Background: Use the primary color to ensure the widget is solid.
       This prevents the global parchment texture from blending through the text. */
    background-color: var(--color-background-primary);

    /* 2. Border: Reinforce the edge to define it as a separate object. */
    border: 2px solid var(--color-border-primary);
    border-radius: 4px;

    /* 3. Shadow: Critical for the "on top" feel. Lift it up! */
    box-shadow:
        0 4px 12px var(--color-overlay-medium),
        inset 0 0 40px var(--color-overlay-subtle); /* Subtle inner vignette for age */

    /* 4. Layering: Ensure it sits above the texture layer */
    position: relative;
    z-index: 2;
}

/* Dark Mode Specifics: Make them feel like stone tablets */
.app-shell[data-ui="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    .infobox,
.app-shell[data-ui="fantasy-pack"][data-mode="dark"]
    .chronicler-content
    .toc-container {
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); /* Deeper shadow for dark mode */
    border-color: var(--color-border-primary);
}
